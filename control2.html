
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control and Learning &#8212; Notes on AI</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/book2_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notes on AI</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="AI_Approach.html">
   AI Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="image_processing.html">
   Image Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estimation.html">
   Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html">
   Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="deep_learning.html">
   Deep Learning &amp; Vision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="control.html">
   Control and Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix_1.html">
   Appendix 1: Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendix_2.html">
   Appendix 2: Local Code
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/control2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jeanwalrand/Notes_on_AI.git/main?urlpath=tree/docs/control2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Control and Learning
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#marble-on-a-board">
   Marble on a board
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulation">
     Simulation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimizing-a-and-b">
     Optimizing
     <span class="math notranslate nohighlight">
      \(a\)
     </span>
     and
     <span class="math notranslate nohighlight">
      \(b\)
     </span>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-the-optimized-system">
     Running the optimized system
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-noise">
     Adding noise
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#marble-on-a-plate">
   Marble on a Plate
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#queuing-system">
   Queuing System
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brute-force-method">
     Brute-Force Method
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-programming">
     Dynamic Programming
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-iteration">
     Policy Iteration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cache-replacement-problem">
   Cache Replacement Problem
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model">
     Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-examples">
     Two Examples
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-1-i-d-d">
       Example 1: i.d.d.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-2-two-state-markov-chain">
       Example 2: two-state Markov chain
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-programming-equations">
     Dynamic Programming Equations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-iteration-algorithm">
     Value Iteration Algorithm
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Policy Iteration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reinforcement-learning">
   Reinforcement Learning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q-learning">
     Q- Learning
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#estimating-an-expected-value">
       Estimating an expected value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q-learning-algorithm">
       Q-Learning Algorithm
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-iteration-with-learning">
     Policy Iteration with Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bandit-problem">
   Bandit Problem
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-on-control">
   Exercise on Control
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="control-and-learning">
<h1>Control and Learning<a class="headerlink" href="#control-and-learning" title="Permalink to this headline">¶</a></h1>
<p>(c) Jean Walrand, September 2021</p>
<p>This chapter explains some concepts and methods for the control of systems and how learning is used when the knowledge of the system is incomplete.</p>
<ul class="simple">
<li><p>We start with the control of the motion of a <strong>marble on a board</strong>.  The system is deterministic and the model is known precisely. For this system, we consider a <strong>parametric controller</strong> and we use a <strong>brute-force</strong> method to find good parameters. We comment on the <strong>complexity</strong> of designing the controller with this approach.</p></li>
<li><p>We then explore the control of the motion of a <strong>marble on a plate</strong>. This is a two-dimensional version of the previous problem. We note that <strong>domain knowledge</strong> is important to simplify the design problem.</p></li>
<li><p>We then use a parametric controller with the brute-force method to design the control of the <strong>service rate of a queuing system</strong>. This is a <strong>stochastic system</strong> and we observe that many simulation runs are needed to evaluate the average performance of the system.  This large number of simulation runs makes the brute-force method impractical for many systems.</p></li>
<li><p>To illustrate optimal control techniques, we introduce a <strong>cache replacement</strong> optimization problem.</p></li>
<li><p>We explain the <strong>dynamic programming</strong> approach and derive the <strong>dynamic programming equations</strong> for the cache replacement problem.</p></li>
<li><p>To solve the dynamic programming equations, we develop the <strong>value iteration algorithm</strong>.</p></li>
<li><p>As an alternate approach, we explain the <strong>policy iteration</strong> algorithm.</p></li>
<li><p>When the system model is not known, one can use <strong>reinforcement learning</strong> methods.  We start with <strong>Q-Learning</strong> that we develop as an approximation of value iteration.</p></li>
<li><p>We then explain <strong>policy iteration with learning</strong>.</p></li>
<li><p>Finally, we discuss a <strong>bandit problem</strong> and present the <strong>Thompson sampling</strong> algorithm. The main point in this example is the tradeoff between exploration and exploitation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, we load ncessearcy libraries</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Javascript</span>
<span class="c1">#from toggle_cell import toggle_code as hide_code</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="c1"># These are plot parameters</span>
         <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
         <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
         <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
         <span class="s1">&#39;lines.markersize&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
         <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Libraries loaded successfully&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Libraries loaded successfully
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="marble-on-a-board">
<h1>Marble on a board<a class="headerlink" href="#marble-on-a-board" title="Permalink to this headline">¶</a></h1>
<p>We explore the <strong>parametric control</strong> of a marble on a board, as illustrated below.  The goal of the controller is to bring the marble to the center of the board by adjusting the angle <span class="math notranslate nohighlight">\(\alpha\)</span> of the board. The observations are the position <span class="math notranslate nohighlight">\(x\)</span> and velocity <span class="math notranslate nohighlight">\(\dot x\)</span> of the marble.</p>
<p><img alt="title" src="_images/marble1.pdf" /></p>
<p>Our parametric controller is <span class="math notranslate nohighlight">\(\alpha = ax + b \dot x\)</span>.  The parameters are <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>. Newton’s law <strong>force = mass <span class="math notranslate nohighlight">\(\times\)</span> acceleration</strong> implies that <span class="math notranslate nohighlight">\(\ddot x = - g  \sin(\alpha)\)</span> where <span class="math notranslate nohighlight">\(g = 9.81m/s^2\)</span>.</p>
<p>To measure how good the controller is at bringing the marble to the center of the board, we use the cost <span class="math notranslate nohighlight">\(C\)</span> defined by</p>
<div class="math notranslate nohighlight">
\[C(a, b) = \int_0^\infty x^2(t) dt.\]</div>
<p>This cost is small if the marble goes quickly close to the center of the board where <span class="math notranslate nohighlight">\(x = 0\)</span>.</p>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<p>In the cell below, we simulate the motion of the marble.  The sliders allow you to change the initial conditions <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(\dot x = v\)</span> as well as the parameters <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>. The simulation uses the following discrete-time approximation where one time step is <span class="math notranslate nohighlight">\(0.1\)</span> second:</p>
<div class="math notranslate nohighlight">
\[x[n+1] = x[n] + 0.1 v[n]; v[n+1] = v[n] - 0.1 \times 9.81 \times \sin(ax[n] + bv[n])\]</div>
<p>where <span class="math notranslate nohighlight">\(v[n] = \dot x[n]\)</span>.  This approximation assumes that the velocity is constant during intervals of <span class="math notranslate nohighlight">\(0.1\)</span> second instead of changing continuously.  The cost is then approximated by</p>
<div class="math notranslate nohighlight">
\[C(a, b) = \sum_{n=0}^{N-1} x^2[n]\]</div>
<p>where <span class="math notranslate nohighlight">\(N = 10T\)</span> is a chosen number of simulation steps that corresponds to <span class="math notranslate nohighlight">\(T\)</span> seconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span><span class="n">bd</span><span class="p">,</span><span class="n">xd</span><span class="p">,</span><span class="n">vd</span><span class="p">,</span><span class="n">Td</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ad</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">bd</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">xd</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">vd</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">Td</span><span class="p">)</span>
    
<span class="n">ad</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.05&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span><span class="s1">&#39;0.15&#39;</span><span class="p">,</span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span><span class="s1">&#39;0.35&#39;</span><span class="p">,</span><span class="s1">&#39;0.4&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.05&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span><span class="s1">&#39;0.15&#39;</span><span class="p">,</span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span><span class="s1">&#39;0.35&#39;</span><span class="p">,</span><span class="s1">&#39;0.4&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">xd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">vd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Td</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;150&#39;</span><span class="p">,</span><span class="s1">&#39;200&#39;</span><span class="p">,</span><span class="s1">&#39;300&#39;</span><span class="p">,</span><span class="s1">&#39;400&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">ad</span> <span class="o">=</span> <span class="n">ad</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="n">bd</span><span class="p">,</span> <span class="n">xd</span> <span class="o">=</span> <span class="n">xd</span><span class="p">,</span><span class="n">vd</span> <span class="o">=</span> <span class="n">vd</span><span class="p">,</span> <span class="n">Td</span> <span class="o">=</span> <span class="n">Td</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "5ac7bcff09d74381846949e24ec8d565"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##### ball on incline - controller based on position and velocity [slide 8]</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We roll the ball with selected parameters a and b initial conditions x and v&#39;</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">rollBall6</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># time step, in seconds</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="o">*</span><span class="mf">9.81</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s1">&#39;X(t)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">G</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (in seconds)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory with x = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;; v = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;; a = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;; b = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">rollBall6</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try other parameters, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We roll the ball with selected parameters a and b initial conditions x and v
</pre></div>
</div>
<img alt="_images/control2_4_1.png" src="_images/control2_4_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try other parameters, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optimizing-a-and-b">
<h2>Optimizing <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span><a class="headerlink" href="#optimizing-a-and-b" title="Permalink to this headline">¶</a></h2>
<p>To find good values of the parameters <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> we use a <strong>brute-force</strong> method.  We simulate the motion of the marble for fixed initial conditions <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(v\)</span> and for a discrete set of possible parameters.  Specifically, <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> take values in the set</p>
<div class="math notranslate nohighlight">
\[\{-5, -5 + 0.1, - 5 + 0.2, \ldots, 5 - 0.2, 5 - 0.1, 5\}.\]</div>
<p>Thus, there are <span class="math notranslate nohighlight">\(101^2\)</span> different pairs <span class="math notranslate nohighlight">\((a, b)\)</span> of parameter values and for each pair, we simulate the motion of the ball for <span class="math notranslate nohighlight">\(100\)</span> steps.  For each simulation run, we keep track of the cost <span class="math notranslate nohighlight">\(C(a, b)\)</span>.  We then find the values of <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> that result in the minimum cost.</p>
<p>Note that to guarantee that the parameters work well for many different initial conditions we should also simulate for a range of such initial conditions.  For simplicity, we do not and hope that if the controller works well for our chosen initial conditions <span class="math notranslate nohighlight">\(x = 2\)</span> and <span class="math notranslate nohighlight">\(v = 1\)</span>, it will work well for others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##### ball on incline - controller based on position and velocity [slide 8]</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We find the best values of a and b when x = 2 and v = 1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The algorithm is running. Please wait ....&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">costBall</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.98</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">C</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">C</span>
    
<span class="k">def</span> <span class="nf">optimizeBall</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">aOpt</span><span class="p">,</span> <span class="n">bOpt</span><span class="p">,</span> <span class="n">minC</span>
    <span class="n">K</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span>
            <span class="n">C</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">costBall</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="n">minC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">aOpt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">bOpt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    
<span class="n">optimizeBall</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>   


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The optimized parameters are:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   a = &#39;</span><span class="p">,</span><span class="n">aOpt</span><span class="p">,</span><span class="s1">&#39;; b = &#39;</span><span class="p">,</span> <span class="n">bOpt</span><span class="p">,</span><span class="s1">&#39;; cost = &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">minC</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We find the best values of a and b when x = 2 and v = 1
The algorithm is running. Please wait ....
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The optimized parameters are:
   a =  0.32 ; b =  0.16 ; cost =  22.42
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="running-the-optimized-system">
<h2>Running the optimized system<a class="headerlink" href="#running-the-optimized-system" title="Permalink to this headline">¶</a></h2>
<p>In the cell below, we simulate the motion of the ball with the <em>optimized</em> parameters. The sliders allow to change the initial conditions.</p>
<p>You should note the following points about this brute-force approach:</p>
<ul class="simple">
<li><p>If there are many parameters, this approach is very time consuming;</p></li>
<li><p>There is no guarantee that the form <span class="math notranslate nohighlight">\(ax + b\dot x\)</span> of the controller is well-chosen.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">vd</span><span class="p">,</span><span class="n">Td</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span>
    <span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xd</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">vd</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">Td</span><span class="p">)</span>
    
<span class="n">xd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">vd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Td</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;150&#39;</span><span class="p">,</span><span class="s1">&#39;200&#39;</span><span class="p">,</span><span class="s1">&#39;300&#39;</span><span class="p">,</span><span class="s1">&#39;400&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">xd</span> <span class="o">=</span> <span class="n">xd</span><span class="p">,</span><span class="n">vd</span> <span class="o">=</span> <span class="n">vd</span><span class="p">,</span> <span class="n">Td</span> <span class="o">=</span> <span class="n">Td</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "1ebfb1160ef843b285b245672dadd6b8"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##### ball on incline - controller based on position and velocity [slide 8]</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We try the optimized controller with different initial conditions x and v&#39;</span><span class="p">)</span>
    
<span class="n">a</span> <span class="o">=</span> <span class="n">aOpt</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">bOpt</span>
    
<span class="k">def</span> <span class="nf">rollBall0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># time step, in seconds</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="o">*</span><span class="mf">9.81</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s1">&#39;X(t)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">G</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (in seconds)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory with x = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;; v = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;; a = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;; b = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">rollBall0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try other parameters, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We try the optimized controller with different initial conditions x and v
</pre></div>
</div>
<img alt="_images/control2_9_1.png" src="_images/control2_9_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try other parameters, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-noise">
<h2>Adding noise<a class="headerlink" href="#adding-noise" title="Permalink to this headline">¶</a></h2>
<p>To verify the robustness of the controller, we add some noise to the motion of the marble.  Specifically, we simulate the action of wind on the marble by perturbing the acceleration.  We use the model</p>
<div class="math notranslate nohighlight">
\[v[n+1] = v[n] - 0.1 \times 9.81 \times \sin(ax[n] + bv[n]) + z[n]\]</div>
<p>where the <span class="math notranslate nohighlight">\(z[n]\)</span> are i.i.d. normal random variables with mean <span class="math notranslate nohighlight">\(0\)</span> and variance <span class="math notranslate nohighlight">\(\sigma^2\)</span>. The variance can be adjusted with a slider.  The simulation shows that the controller is good at maintaining the marble close to the center of the board. This example illustrates the power of <strong>feedback</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">vd</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">Td</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span>
    <span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xd</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">vd</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">sd</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">Td</span><span class="p">)</span>
    
<span class="n">xd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">vd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.05&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span><span class="s1">&#39;0.15&#39;</span><span class="p">,</span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span><span class="s1">&#39;0.3&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Td</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;150&#39;</span><span class="p">,</span><span class="s1">&#39;200&#39;</span><span class="p">,</span><span class="s1">&#39;300&#39;</span><span class="p">,</span><span class="s1">&#39;400&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">xd</span> <span class="o">=</span> <span class="n">xd</span><span class="p">,</span><span class="n">vd</span> <span class="o">=</span> <span class="n">vd</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span><span class="n">Td</span> <span class="o">=</span> <span class="n">Td</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "9e95f9aca52a42fe9f34c1200c5c9324"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rolling ball on incline with noise </span>

<span class="n">a</span> <span class="o">=</span> <span class="n">aOpt</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">bOpt</span>

<span class="k">def</span> <span class="nf">rollBall1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># time step, in seconds</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="o">*</span><span class="mf">9.81</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s1">&#39;X(t)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">G</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (in seconds)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory with noise, stdev = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;; x = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;; v = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">rollBall1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try other parameters, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_12_0.png" src="_images/control2_12_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try other parameters, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="marble-on-a-plate">
<h1>Marble on a Plate<a class="headerlink" href="#marble-on-a-plate" title="Permalink to this headline">¶</a></h1>
<p>At first glance, a marble on a plate looks like a much more complex control problem than on a board.
<img alt="title" src="_images/marble2.pdf" /></p>
<p>We now control two angles: one for each axis.  If we assume a linear control, each angle is now a function of the two-dimensional position and the two-dimensional velocity. Thus, there are four parameters for each angle, for a total of eight parameters. If each parameter can take <span class="math notranslate nohighlight">\(101\)</span> different values, as in the one-dimensional example, there are more than <span class="math notranslate nohighlight">\(10^8\)</span> possible vectors of parameters to explore.  This is prohibitive.</p>
<p>However, if we look more closely at the problem, we realize that the motions along the two directions are decoupled. Thus, it suffices to use the optimized one-dimensional controller in each direction.  The cell below simulates that approach.</p>
<p>This example is a simple illustration of the fact that some <strong>domain knowledge</strong> can guide the selection of the controller.  One should not use a blind black-box approach. If it is a nail, use a hammer.  But, if it is a screw, use a screwdriver.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">x0d</span><span class="p">,</span><span class="n">v0d</span><span class="p">,</span><span class="n">x1d</span><span class="p">,</span><span class="n">v1d</span><span class="p">,</span><span class="n">Td</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">x0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">T</span>
    <span class="n">x0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x0d</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">v0d</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">x1d</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">v1d</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">Td</span><span class="p">)</span>
    
<span class="n">x0d</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">v0d</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v0&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">x1d</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">v1d</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-5&#39;</span><span class="p">,</span> <span class="s1">&#39;-4&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Td</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="s1">&#39;150&#39;</span><span class="p">,</span><span class="s1">&#39;200&#39;</span><span class="p">,</span><span class="s1">&#39;300&#39;</span><span class="p">,</span><span class="s1">&#39;400&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">x0d</span> <span class="o">=</span> <span class="n">x0d</span><span class="p">,</span><span class="n">v0d</span> <span class="o">=</span> <span class="n">v0d</span><span class="p">,</span> <span class="n">x1d</span><span class="o">=</span><span class="n">x1d</span><span class="p">,</span><span class="n">v1d</span><span class="o">=</span><span class="n">v1d</span><span class="p">,</span><span class="n">Td</span> <span class="o">=</span> <span class="n">Td</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "ccb0b338d0e644e3ad4c60f478f4223a"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2D rolling ball</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">aOpt</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">bOpt</span>

    
<span class="k">def</span> <span class="nf">rollBall2</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">])</span>
    <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">]</span>
    <span class="n">V</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>        
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]</span>
            <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.98</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;X[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,n]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory X with X[0] = [&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;] and V[0] = [&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    

<span class="n">rollBall2</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try other parameters, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_15_0.png" src="_images/control2_15_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try other parameters, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="queuing-system">
<h1>Queuing System<a class="headerlink" href="#queuing-system" title="Permalink to this headline">¶</a></h1>
<p>To illustrate the control of a <strong>stochastic system</strong>, we consider the queuing system shown below.</p>
<p><img alt="title" src="_images/queue.pdf" /></p>
<p>The model is in discrete time. At each step <span class="math notranslate nohighlight">\(n\)</span>, a new customer arrives with probability <span class="math notranslate nohighlight">\(\lambda\)</span> and a service in progress terminates with probability <span class="math notranslate nohighlight">\(\mu_n\)</span>.  Here, <span class="math notranslate nohighlight">\(\mu_n\)</span> is the controlled service rate.  We can choose a slow service rate <span class="math notranslate nohighlight">\(\mu_n = 0.2\)</span>
or a faster service rate <span class="math notranslate nohighlight">\(\mu_n = 0.4\)</span>, say by hiring a co-worker to speed up the processing.  The goal is to choose the service rate as a function of the number <span class="math notranslate nohighlight">\(X_n\)</span> of customers in the queue to minimize the expected cost of running the system. This expected cost is</p>
<div class="math notranslate nohighlight">
\[C = E\left[\sum_{n=0}^N (X_n + \alpha \mu_n)\right].\]</div>
<p>This cost has two components: the cost of having customers waiting in the queue and the cost of service. The constant <span class="math notranslate nohighlight">\(\alpha\)</span> reflect the relative weights of these two costs.</p>
<div class="section" id="brute-force-method">
<h2>Brute-Force Method<a class="headerlink" href="#brute-force-method" title="Permalink to this headline">¶</a></h2>
<p>We explore a parametric control <span class="math notranslate nohighlight">\(\mu_n = 0.2 + 0.2 \times 1\{X_n &gt; a\}\)</span> where <span class="math notranslate nohighlight">\(a\)</span> is the parameter.  It is sensible to speed up service when there are many customers waiting.  In the cell below, we simulate the system many times for different values of <span class="math notranslate nohighlight">\(a\)</span> in order to find the best one. The simulations show that <span class="math notranslate nohighlight">\(a = 3\)</span> is best when <span class="math notranslate nohighlight">\(\lambda = 0.2\)</span>.</p>
<p>The main point of this example is that if the system is stochastic, one needs a <strong>large number of simulation runs</strong> in order to estimate the expected cost.  Even if the number of parameter values to explore is small, the brute-force approach is <strong>prohibitive</strong> for most practical stochastic systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choosing a service rate: Brute-force learning</span>

<span class="k">def</span> <span class="nf">queuingCost</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">lamb</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mu</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">lamb</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">mu</span>
    <span class="k">return</span> <span class="n">C</span>
        
<span class="k">def</span> <span class="nf">bruteForceQueue</span><span class="p">(</span><span class="n">lamb</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Algorithm is running.  Please wait.....&#39;</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Almost done ...&#39;</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">simStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
                <span class="n">C</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">queuingCost</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">lamb</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>            
        <span class="n">minC</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">minStepCost</span> <span class="o">=</span> <span class="n">minC</span><span class="o">/</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Step Cost as a function of threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">bruteForceQueue</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>            
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Algorithm is running.  Please wait.....
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Almost done ...
</pre></div>
</div>
<img alt="_images/control2_17_2.png" src="_images/control2_17_2.png" />
</div>
</div>
</div>
<div class="section" id="dynamic-programming">
<h2>Dynamic Programming<a class="headerlink" href="#dynamic-programming" title="Permalink to this headline">¶</a></h2>
<p>Optimizing parametric controllers with a brute-force evaluation of all the possible values of parameters is intractable for most practical systems. <strong>Dynamic programming</strong> is a methodology to derive the optimal controller.  You will note that this approach does not assume that the optimal service rate if of the form <span class="math notranslate nohighlight">\(0.2 + 0.1 \times 1\{x &gt; a\}\)</span>.  It only assumes that the optimal service rate is a function of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(V(x)\)</span> be the minimum possible value of the <strong>expected total discounted cost</strong>:</p>
<div class="math notranslate nohighlight">
\[ V(x) = \min E \left[ \sum_{n=0}^\infty \rho^n (X_n + \alpha \mu_n) \mid X_0 = x\right].\]</div>
<p>The minimum is over all possible strategies where we choose
the service rate <span class="math notranslate nohighlight">\(\mu_n \in \{0.2, 0.4\}\)</span> as a function of <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(X_n\)</span>. The quantity <span class="math notranslate nohighlight">\(V(x)\)</span> is called the <strong>value of state</strong> <span class="math notranslate nohighlight">\(x\)</span> and the function <span class="math notranslate nohighlight">\(V(\cdot)\)</span> is called the <strong>Value Function</strong>.</p>
<p>Here, <span class="math notranslate nohighlight">\(\rho \in (0, 1)\)</span> is the <strong>discount factor</strong>. It captures the fact that future costs are less important than the current cost, say because of inflation.  If <span class="math notranslate nohighlight">\(\rho \approx 1\)</span>, the problem is essentially the same as minimizing the total cost over a large horizon or minimizing the average cost per step, as we explain next.</p>
<p>Intuitively, one should expect that the optimal policy does not depend on time because the infinite future always looks the same given the value of the current state <span class="math notranslate nohighlight">\(X_n\)</span>.  Also, if one uses the optimal policy, the queuing system behaves like a Markov chain that is irreducible since the queue always has a chance to get empty and to reach any state from the empty state <span class="math notranslate nohighlight">\(x = 0\)</span>.  Moreover, choosing <span class="math notranslate nohighlight">\(\mu = 0.4\)</span> in all states makes the chain positive recurrent and have a finite discounted cost (because the likelihood of <span class="math notranslate nohighlight">\(x\)</span> decreases exponentially in <span class="math notranslate nohighlight">\(x\)</span>). Consequently, that is also be the case under the optimal policy.  Consequently, under the optimal policy, the probability mass function of <span class="math notranslate nohighlight">\(X_n\)</span> approaches some distribution <span class="math notranslate nohighlight">\(\pi\)</span> that is invariant.  If <span class="math notranslate nohighlight">\(\rho \approx 1\)</span>, the expected cost at step <span class="math notranslate nohighlight">\(n\)</span> then approaches the expected value of <span class="math notranslate nohighlight">\(X_n + \beta g(X_n)\)</span> under <span class="math notranslate nohighlight">\(\pi\)</span> where <span class="math notranslate nohighlight">\(\mu_n = g(X_n)\)</span> is the optimal policy.  Hence, the expected total discounted cost approaches</p>
<div class="math notranslate nohighlight">
\[ \sum_{n=0}^\infty \rho^n \sum_x \pi(x)  (x + \alpha g(x)).\]</div>
<p>This expression is equal to</p>
<div class="math notranslate nohighlight">
\[(1 - \rho)^{-1} \sum_x \pi(x) (x + \alpha g(x)) = (1 - \rho)^{-1} A\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is the average cost per step.</p>
<p>Let <span class="math notranslate nohighlight">\(Q(x, u)\)</span> be the minimum value of the total expected discounted cost given that <span class="math notranslate nohighlight">\(X_0 = x\)</span>
and that <span class="math notranslate nohighlight">\(\mu_0 = u\)</span>.  Thus, at step <span class="math notranslate nohighlight">\(0\)</span> we choose the service rate <span class="math notranslate nohighlight">\(u \in \{0.2, 0.4\}\)</span> and
after step <span class="math notranslate nohighlight">\(1\)</span> we use the strategy <span class="math notranslate nohighlight">\(\mu(X_n)\)</span> that achieves the minimum expected total discounted cost.  Note that <span class="math notranslate nohighlight">\(V(x) = \min \{Q(x,0.2), Q(x, 0.4)\}\)</span>.  Also, the optimal policy is the value of <span class="math notranslate nohighlight">\(\mu\)</span> that achieves the minimum in this expression.</p>
<p>The key observation is that if <span class="math notranslate nohighlight">\(X_0 = x\)</span> and <span class="math notranslate nohighlight">\(\mu_0 = u\)</span>, we pay the cost <span class="math notranslate nohighlight">\(x + \alpha u\)</span>
at step <span class="math notranslate nohighlight">\(0\)</span> and the minimum cost starting from <span class="math notranslate nohighlight">\(X_1\)</span> is then <span class="math notranslate nohighlight">\(\rho V(X_1)\)</span>.  Indeed, the problem of minimizing the cost starts afresh from <span class="math notranslate nohighlight">\(X_1\)</span> at time <span class="math notranslate nohighlight">\(1,\)</span> but all the costs are discounted by a factor <span class="math notranslate nohighlight">\(\rho\)</span> more than if we started from time <span class="math notranslate nohighlight">\(0\)</span>.  For instance, the cost starting from <span class="math notranslate nohighlight">\(X_1\)</span> at time <span class="math notranslate nohighlight">\(1\)</span> is multiplied by <span class="math notranslate nohighlight">\(\rho\)</span> whereas if we started from <span class="math notranslate nohighlight">\(X_1\)</span> at time <span class="math notranslate nohighlight">\(0\)</span> it would be multipled by <span class="math notranslate nohighlight">\(\rho^0 = 1\)</span>.</p>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[Q(x, u) = x + \alpha u + \rho E[ V(X_1) \mid X_0 = x, \mu_0 = u].\]</div>
<p>Also,</p>
<div class="math notranslate nohighlight">
\[V(x) = \min \{Q(x, 0.2), Q(x, 0.4)\}.\]</div>
<p>Accordingly,</p>
<div class="math notranslate nohighlight">
\[Q(x, u) = x + \alpha u + \rho E[ \min(Q(X_1,0.2), Q(X_1,0.4)) \mid X_0 = x, \mu_0 = u].\]</div>
<p>These equations are the <strong>Dynamic Programming Equations.</strong>  If we solve these equations, as we noted above, the best action to take when the state is <span class="math notranslate nohighlight">\(x\)</span> is the value of <span class="math notranslate nohighlight">\(u\)</span> that achieves the minimum of <span class="math notranslate nohighlight">\(Q(x,0.2)\)</span> and <span class="math notranslate nohighlight">\(Q(x, 0.4)\)</span>.</p>
<p>If <span class="math notranslate nohighlight">\(X_0 = x\)</span> and <span class="math notranslate nohighlight">\(\mu_0 = u\)</span>, then <span class="math notranslate nohighlight">\(X_1 = x + 1\)</span> with probability <span class="math notranslate nohighlight">\(\lambda (1 - \mu)\)</span>, and similarly for the other possibilities.  Thus, it is easy to write down the dynamic programming equations.  One complication is that they are nonlinear (because of the minimum).  Another is that there are infinitely many such equations (one for each <span class="math notranslate nohighlight">\(x\)</span> and for each <span class="math notranslate nohighlight">\(u\)</span>).  To address the second complication, we truncate the set of values of <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(\{0, 1, \ldots, K-1\}\)</span>.
To handle the first complication, we note that the equations have the form</p>
<div class="math notranslate nohighlight">
\[Q = F(Q)\]</div>
<p>where <span class="math notranslate nohighlight">\(Q\)</span> is the vector of values of <span class="math notranslate nohighlight">\(Q(x, u)\)</span> for <span class="math notranslate nohighlight">\(x\)</span> in <span class="math notranslate nohighlight">\(\{0, 1, \ldots, K-1\}\)</span> and <span class="math notranslate nohighlight">\(u\)</span> in <span class="math notranslate nohighlight">\(\{0.2, 0.4\}\)</span>.  To solve these <strong>fixed-point equations</strong>, we use the iteration <span class="math notranslate nohighlight">\(Q_{t+1} = F(Q_t)\)</span>.  One can show theoretically that this iteration converges.  We do the calculations in the next cell.</p>
<p>You can verify that <span class="math notranslate nohighlight">\((1 - \rho) V(x)\)</span> approaches some limit as <span class="math notranslate nohighlight">\(\rho\)</span> approaches <span class="math notranslate nohighlight">\(1\)</span>. That limit is the minimum expected cost per step. Moreover, you should appreciate the benefits of the dynamic programming approach: 1) it computes the optimal policy without assuming some parametric form; 2) the calculation is much faster than the brute-force approach that requires a long simulation for each possible value of the parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># number of states</span>
<span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span> <span class="c1"># possible values of mu</span>
<span class="n">lam</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># arrival rate</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="c1"># discount rate</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of iterations</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">EV</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">W</span><span class="p">):</span> <span class="c1"># Expected value of V(X1) given X0 = x and mu0 = U[u]</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">lam</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">],</span><span class="n">W</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">],</span><span class="n">W</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lam</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">W</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="n">z</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">EV</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">Q</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:])</span>
            
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value Iteration&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$(1 - r)Q_t(0,0)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$(1 - r)Q_t(0,1)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration step $t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optimal Service Rate $\mu(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">mu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                                  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_19_0.png" src="_images/control2_19_0.png" />
<img alt="_images/control2_19_1.png" src="_images/control2_19_1.png" />
</div>
</div>
</div>
<div class="section" id="policy-iteration">
<h2>Policy Iteration<a class="headerlink" href="#policy-iteration" title="Permalink to this headline">¶</a></h2>
<p>The <strong>policy iteration approach</strong> recursively updates the policy instead of updating the value function.</p>
<p>The basic idea is as follows.  Assume that one uses the policy <span class="math notranslate nohighlight">\(\mu = g(x)\)</span> at every step.
Let <span class="math notranslate nohighlight">\(C(g, x)\)</span> be the expected total discounted cost when using that poliicy given that <span class="math notranslate nohighlight">\(X_0 = x\)</span>.  We claim that</p>
<div class="math notranslate nohighlight">
\[C(g, x) = x + \alpha g(x) + \rho E[C(g, X_1) \mid X_0 = x, \mu_0 = g(x)].\]</div>
<p>Indeed, the cost at step <span class="math notranslate nohighlight">\(0\)</span> is <span class="math notranslate nohighlight">\(x + \alpha g(x)\)</span> and the cost starting from <span class="math notranslate nohighlight">\(X_1\)</span> at step <span class="math notranslate nohighlight">\(1\)</span> is the same as starting from <span class="math notranslate nohighlight">\(X_1\)</span> at step <span class="math notranslate nohighlight">\(0\)</span>, except that it is discouned by an additional factor <span class="math notranslate nohighlight">\(\rho\)</span>.</p>
<p>These equations are linear in the unknowns <span class="math notranslate nohighlight">\(C(g, x)\)</span>.  It is then easy to solve for these unknowns.  (After truncating the state space to <span class="math notranslate nohighlight">\(\{0, 1, \dots, K-1\}\)</span>, there are only <span class="math notranslate nohighlight">\(K\)</span> unknowns.) This is the <strong>policy evaluation</strong> step.</p>
<p>The policy iteration then proceeds as follows.  Let us imagine that the policy is <span class="math notranslate nohighlight">\(\mu = g(x)\)</span> at steps <span class="math notranslate nohighlight">\(1, 2, \ldots\)</span>.  The expected cost starting from step <span class="math notranslate nohighlight">\(1\)</span> is then <span class="math notranslate nohighlight">\(C(g, X_1)\)</span>.  If we use the service rate <span class="math notranslate nohighlight">\(u\)</span> at step <span class="math notranslate nohighlight">\(0\)</span> and if <span class="math notranslate nohighlight">\(X_0 = x\)</span>, the total expected discounted cost is then</p>
<div class="math notranslate nohighlight">
\[x + \alpha g(x) + \rho E[C(g, X_1) \mid X_0 = x, \mu_0 = g(x)].\]</div>
<p>At step <span class="math notranslate nohighlight">\(0\)</span>, let us choose the value of <span class="math notranslate nohighlight">\(u\)</span> that minimizes this expression.  This defines a new policy <span class="math notranslate nohighlight">\(g'(x)\)</span>.  This is the <strong>policy improvement step</strong>.  One can then evaluate this new policy as before, and then improve that policy.  The policy iteration algorithm iterates the policy evaluation and policy improvement steps.  We do the calculations in the next cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># number of states</span>
<span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span> <span class="c1"># possible values of mu</span>
<span class="n">lam</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># arrival rate</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="c1"># discount rate</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of iterations</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">T</span><span class="p">,</span><span class="n">K</span><span class="p">])</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># 2D array of integers 0</span>

<span class="k">def</span> <span class="nf">PT</span><span class="p">(</span><span class="n">g</span><span class="p">):</span> <span class="c1"># calculation of P[x,x&#39;] = P[X_1 = x&#39; | X_0 = x, mu = U[g(x)]]</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">])</span> 
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">P</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">K</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">P</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lam</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">P</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">x</span><span class="p">,:])</span>
    <span class="k">return</span> <span class="n">P</span>

<span class="k">def</span> <span class="nf">SC</span><span class="p">(</span><span class="n">g</span><span class="p">):</span> <span class="c1"># calculation of b[x] = x + alpha*U[g(x)] = step cost</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
        <span class="n">w</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">mu</span>
    <span class="k">return</span> <span class="n">w</span>
    
<span class="k">def</span> <span class="nf">PEV</span><span class="p">(</span><span class="n">g</span><span class="p">):</span> <span class="c1"># Evaluation of C(g,x) where g(x) is in [0,1] for x in 0, ..., K-1    </span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">SC</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">PT</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="c1"># Solve the equations C = b + rho*P*C, i.e., AC = b with A = I - rho*P</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">-</span> <span class="n">rho</span><span class="o">*</span><span class="n">P</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">CP</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">g</span><span class="p">):</span> <span class="c1"># evaluation of SC(u) + rho*C(g)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PT</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">)]),</span><span class="n">PEV</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">W</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">W</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[</span><span class="n">t</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">PEV</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># policy evaluation</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span> <span class="c1"># policy improvement</span>
        <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="n">CP</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="p">[:,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="n">x</span><span class="p">],</span><span class="n">CP</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="p">[:,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="n">x</span><span class="p">]])</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="n">mu</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Optimal Service Rate $\mu(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="n">mu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_21_0.png" src="_images/control2_21_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="cache-replacement-problem">
<h1>Cache Replacement Problem<a class="headerlink" href="#cache-replacement-problem" title="Permalink to this headline">¶</a></h1>
<p>We explain dynamic programming in the case of a total expected discounted cost for a controlled Markov process.</p>
<div class="section" id="model">
<h2>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<p>Specifically, we explore the cache replacement problem illustrated below. We choose this example because a brute-force approach is prohibitive; the example demonstrates the superiority of a more systematic methodology. Also, the example is simple enough to develop an intuitive understanding of what is going on. Moreover, the example allows us to develop the key ideas with a minimal amount of notation.
<img alt="title" src="_images/cache.pdf" />
There is a buffer that can contain only one item <span class="math notranslate nohighlight">\(Y_n\)</span>.  At time <span class="math notranslate nohighlight">\(n\)</span>, the request is for item <span class="math notranslate nohighlight">\(X_n\)</span> and we decide
to keep item <span class="math notranslate nohighlight">\(Y_n\)</span> in the buffer.  This item <span class="math notranslate nohighlight">\(Y_n\)</span> is either <span class="math notranslate nohighlight">\(X_n\)</span> or the item that was in the buffer at step <span class="math notranslate nohighlight">\(n-1\)</span>. Then, at step <span class="math notranslate nohighlight">\(n+1\)</span>, the request is for item <span class="math notranslate nohighlight">\(X_{n+1}\)</span>, as shown in the figure.  If <span class="math notranslate nohighlight">\(X_{n+1} = Y_n\)</span>, we are lucky and we can serve the request at no cost.  However, if <span class="math notranslate nohighlight">\(X_{n+1} \neq Y_n\)</span>, we have to go fetch <span class="math notranslate nohighlight">\(X_{n+1}\)</span> at a unit cost.  We then have to decide whether to keep <span class="math notranslate nohighlight">\(Y_n\)</span> in the buffer or to replace it by <span class="math notranslate nohighlight">\(X_{n+1}\)</span>.  The <strong>cache replacement</strong> policy (keep or replace) tries to minimize the expected cost of fetching items.</p>
<p>The expected cost is</p>
<div class="math notranslate nohighlight">
\[C = E\left[\sum_{n=0}^\infty \rho^n 1\{X_{n+1} \neq Y_n\}\right].\]</div>
<p>In this expression, <span class="math notranslate nohighlight">\(1\{X_{n+1} \neq Y_n\}\)</span> is equal to one if <span class="math notranslate nohighlight">\(X_{n+1} \neq Y_n\)</span> and to zero if <span class="math notranslate nohighlight">\(X_{n+1} = Y_n\)</span>. Thus, <span class="math notranslate nohighlight">\(1\{X_{n+1} \neq Y_n\}\)</span> is the cost incurred at step <span class="math notranslate nohighlight">\(n\)</span>.
Also, <span class="math notranslate nohighlight">\(\rho \in (0, 1)\)</span> is the <strong>discount factor</strong>. It captures the fact that future costs are less important that current costs. You can view discounting either as an economic reality or as a mathematical artefact that enables to study a very long time horizon without the cost going to infinity.  (Recall that the sum of <span class="math notranslate nohighlight">\(\rho^n\)</span> is finite, so that the total cost is bounded.)</p>
<p>We assume that the requests form a Markov chain defined by a transition matrix <span class="math notranslate nohighlight">\(P\)</span> such that</p>
<div class="math notranslate nohighlight">
\[P[X_{n+1} = x' \mid X_n = x, X_{n-1}, \ldots, X_0] = P(x, x').\]</div>
<p>One can show that the optimal cache replacement policy is the same at all steps. One says that the optimal policy is <strong>stationary</strong>. Intuitively, the future always looks the same since we face an infinite total discounted cost that always has the same formulation. A <strong>stationary cache replacement policy</strong> is defined by a function <span class="math notranslate nohighlight">\(\gamma\)</span> such that <span class="math notranslate nohighlight">\(Y_{n+1} = \gamma(X_{n+1}, Y_n) \in \{X_{n+1}, Y_n\}\)</span>.  Indeed, when a new item <span class="math notranslate nohighlight">\(X_{n+1}\)</span> is requested and <span class="math notranslate nohighlight">\(Y_n\)</span> is in the buffer, one has to decide which of <span class="math notranslate nohighlight">\(\{X_{n+1}, Y_n\}\)</span> to keep in the buffer. Thus, for each pair of distinct items <span class="math notranslate nohighlight">\((x, y)\)</span>, there
are two possible values of <span class="math notranslate nohighlight">\(\gamma(x, y)\)</span>: either <span class="math notranslate nohighlight">\(x\)</span> or <span class="math notranslate nohighlight">\(y\)</span>. If there are <span class="math notranslate nohighlight">\(K\)</span> possible items, there are
<span class="math notranslate nohighlight">\(M = K(K-1)/2\)</span> pairs <span class="math notranslate nohighlight">\((x, y)\)</span> of distinct items.  Hence, there are <span class="math notranslate nohighlight">\(2^M\)</span> possible cache replacement policies. This number <span class="math notranslate nohighlight">\(M\)</span> is very large even for small values of <span class="math notranslate nohighlight">\(M\)</span>. For instance, it is about <span class="math notranslate nohighlight">\(10^{13}\)</span> when <span class="math notranslate nohighlight">\(K = 10\)</span>. Consequently, a brute-force approach to choose the policy is prohibitive.</p>
<p>The <strong>state</strong> of the system at step <span class="math notranslate nohighlight">\(n\)</span> is <span class="math notranslate nohighlight">\((X_n, Y_n)\)</span>.  By definition, the state is the minimum amount of information one needs to predict the future of the system.  We need to remember <span class="math notranslate nohighlight">\(X_n\)</span> because the likelihood of future requests depends on <span class="math notranslate nohighlight">\(X_n\)</span> since the requests form a Markov chain.  Also, we need to know <span class="math notranslate nohighlight">\(Y_n\)</span> because the item in the buffer affects what can happen next.  There are <span class="math notranslate nohighlight">\(K \times K\)</span> possible states since there are <span class="math notranslate nohighlight">\(K\)</span> possible values of <span class="math notranslate nohighlight">\(X_n\)</span> and <span class="math notranslate nohighlight">\(K\)</span> possible values of <span class="math notranslate nohighlight">\(Y_n\)</span>.</p>
</div>
<div class="section" id="two-examples">
<h2>Two Examples<a class="headerlink" href="#two-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-1-i-d-d">
<h3>Example 1: i.d.d.<a class="headerlink" href="#example-1-i-d-d" title="Permalink to this headline">¶</a></h3>
<p>Assume that the requests <span class="math notranslate nohighlight">\(X_n\)</span> are <strong>i.i.d.</strong> with <span class="math notranslate nohighlight">\(P(X_n = x) = \pi(x)\)</span> for <span class="math notranslate nohighlight">\(x \in {\cal X}\)</span>.  (I.i.d. means independent and identically distributed.) This is a particular Markov chain with <span class="math notranslate nohighlight">\(P(x, y) = \pi(y)\)</span> for all <span class="math notranslate nohighlight">\(x, y\)</span>.</p>
<p>In this case, it is intuitively clear that one should always keep in the buffer the item most likely to be requested.  That is,</p>
<div class="math notranslate nohighlight">
\[\gamma(x, y) = x \mbox{ if } \pi(x) &gt; \pi(y) \mbox{ and } \gamma(x, y) = y \mbox{ otherwise}.\]</div>
<p>This example is useful for checking that our algorithm is implemented correctly.</p>
</div>
<div class="section" id="example-2-two-state-markov-chain">
<h3>Example 2: two-state Markov chain<a class="headerlink" href="#example-2-two-state-markov-chain" title="Permalink to this headline">¶</a></h3>
<p>Assume the requests are a Markov chain with the transition diagram shown below.
<img alt="title" src="_images/cache2.pdf" />
This diagram illustrates the transition matrix.  It means that</p>
<div class="math notranslate nohighlight">
\[P(0, 0) = 0.6, P(0, 1) = 0.4, P(1, 0) = 0.3, \mbox{ and } P(1, 1) = 0.7.\]</div>
<p>For this transition matrix, the optimal policy is to always replace the item by a different requested item.  For instance, if <span class="math notranslate nohighlight">\(0\)</span> is in the buffer and item <span class="math notranslate nohighlight">\(1\)</span> is requested, then we should replace <span class="math notranslate nohighlight">\(0\)</span> by <span class="math notranslate nohighlight">\(1\)</span> in the buffer.  To see this, note that if the request is for item <span class="math notranslate nohighlight">\(1\)</span>, then the most likely next request is again for item <span class="math notranslate nohighlight">\(1\)</span>, and similarly if the request is for item <span class="math notranslate nohighlight">\(0\)</span>.  Note that item <span class="math notranslate nohighlight">\(1\)</span> is requested more frequently than item <span class="math notranslate nohighlight">\(0\)</span>, on average.  However, one does not always keep item <span class="math notranslate nohighlight">\(1\)</span> in the buffer, in contrast with the previous example.  This example is also useful to check our algorithm implementation.</p>
<p>For a more general case, the optimal policy is not intuitively clear.</p>
</div>
</div>
<div class="section" id="dynamic-programming-equations">
<h2>Dynamic Programming Equations<a class="headerlink" href="#dynamic-programming-equations" title="Permalink to this headline">¶</a></h2>
<p>Let <span class="math notranslate nohighlight">\(Q(x, y)\)</span> be the minimum total expected discounted cost given that <span class="math notranslate nohighlight">\(X_0 = x\)</span> and <span class="math notranslate nohighlight">\(Y_0 = y\)</span>.
Here, <span class="math notranslate nohighlight">\(y\)</span> is the item that was in the before when we started, and we decide to keep it in the buffer.  Similarly, <span class="math notranslate nohighlight">\(Q(x, x)\)</span>
is the minimum total expected discounted cost given that <span class="math notranslate nohighlight">\(X_0 = x\)</span> and <span class="math notranslate nohighlight">\(Y_0 = x\)</span>, i.e., when we
replace <span class="math notranslate nohighlight">\(y\)</span> by <span class="math notranslate nohighlight">\(x\)</span>.  In particular, the minimum total expected cost is <span class="math notranslate nohighlight">\(\min \{Q(x, x), Q(x, y)\}\)</span>
and the optimal policy is then such that</p>
<div class="math notranslate nohighlight">
\[\gamma(x, y) = x \mbox{ if } Q(x, x) &lt; Q(x, y) \mbox{ and } \gamma(x, y) = y \mbox{ otherwise.} ~~~~(1)\]</div>
<p>This minimum cost corresponds to using the optimal cache replacement policy <span class="math notranslate nohighlight">\(\gamma\)</span> at every step, starting at step <span class="math notranslate nohighlight">\(0\)</span>.  This cost is then</p>
<div class="math notranslate nohighlight">
\[Q(x, y) = E[\sum_{n=0}^\infty \rho^n 1\{X_{n+1} \neq Y_n\} \mid X_0 = x, Y_0 = y].\]</div>
<p>This cost has two components: the cost of step <span class="math notranslate nohighlight">\(n = 0\)</span> and the cost starting from step <span class="math notranslate nohighlight">\(1\)</span>.
The cost of step <span class="math notranslate nohighlight">\(n = 0\)</span> is</p>
<div class="math notranslate nohighlight">
\[\sum_{x'} P(x, x') 1\{x' \neq y\}\]</div>
<p>since, given <span class="math notranslate nohighlight">\(X_0 = x\)</span>, one has <span class="math notranslate nohighlight">\(X_1 = x'\)</span> with probability <span class="math notranslate nohighlight">\(P(x, x')\)</span>. The cost starting from step <span class="math notranslate nohighlight">\(1\)</span> is the cost of using the optimal policy, starting from <span class="math notranslate nohighlight">\(x'\)</span> with probability <span class="math notranslate nohighlight">\(P(x, x')\)</span>.  With that probability <span class="math notranslate nohighlight">\(P(x, x')\)</span>,
the minimum cost is <span class="math notranslate nohighlight">\(\min \{\rho Q(x', x'), \rho Q(x', y)\}\)</span>. Indeed, <span class="math notranslate nohighlight">\(\rho Q(x', x')\)</span> is the minimum
cost starting from step <span class="math notranslate nohighlight">\(1\)</span> when <span class="math notranslate nohighlight">\(x'\)</span> last arrived and we decide to keep <span class="math notranslate nohighlight">\(x'\)</span> in the buffer instead of <span class="math notranslate nohighlight">\(y\)</span>. The factor <span class="math notranslate nohighlight">\(\rho\)</span> is because every step starting from step <span class="math notranslate nohighlight">\(1\)</span> occurs one step later than if we were to start from step <span class="math notranslate nohighlight">\(0\)</span>, so that the cost of each step is discounted by an additional factor <span class="math notranslate nohighlight">\(\rho\)</span>.  Similarly, <span class="math notranslate nohighlight">\(\rho Q(x', y)\)</span> is he minimum
cost starting from step <span class="math notranslate nohighlight">\(1\)</span> when <span class="math notranslate nohighlight">\(x'\)</span> last arrived and we decide to keep <span class="math notranslate nohighlight">\(y\)</span> in the buffer.</p>
<p>Adding these two components, we find that</p>
<div class="math notranslate nohighlight">
\[Q(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} P(x, x') \min \{\rho Q(x', x'), \rho Q(x', y)\}.~~~~(2)\]</div>
<p>These are the <strong>dynamic programming equations</strong> for the minimum cost.  If we can solve them, then we can find the optimal policy as we saw in (1).</p>
</div>
<div class="section" id="value-iteration-algorithm">
<h2>Value Iteration Algorithm<a class="headerlink" href="#value-iteration-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The dynamic programming equations (2) are a system of <span class="math notranslate nohighlight">\(K^2\)</span> nonlinear equations.  They are <strong>fixed-point equations</strong> of the form <span class="math notranslate nohighlight">\(Q = F(Q)\)</span> where <span class="math notranslate nohighlight">\(F(\cdot)\)</span> is the right-hand side of (2).  To solve them, we use the iteration <span class="math notranslate nohighlight">\(Q_n = F(Q_{n-1})\)</span>, starting with <span class="math notranslate nohighlight">\(Q_0 = 0\)</span>.  That is,</p>
<div class="math notranslate nohighlight">
\[Q_n(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} P(x, x') \min \{\rho Q_{n-1}(x', x'), \rho Q_{n-1}(x', y)\}.~~~~(3)\]</div>
<p>The equations (3) form the <strong>value iteration algorithm</strong>. One can show that <span class="math notranslate nohighlight">\(Q_n \to Q\)</span>. The key idea is that because <span class="math notranslate nohighlight">\(\rho &lt; 1\)</span> the distance between successive <span class="math notranslate nohighlight">\(Q_n\)</span> gets smaller geometrically fast.</p>
<p>The cell below implements the value iterations algorithm. It also plots the successive values of <span class="math notranslate nohighlight">\(Q_n\)</span> and the policy corresponding to each <span class="math notranslate nohighlight">\(Q_n\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Caching Example: Value Iteration</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span>
<span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">gamma</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>            
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">k</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">],</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">W</span>
    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Q</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Q[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value Iteration: Values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.005</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mf">0.02</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;gamma[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value Iteration: Policy (values separated for clarity)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_26_0.png" src="_images/control2_26_0.png" />
<img alt="_images/control2_26_1.png" src="_images/control2_26_1.png" />
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Policy Iteration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The <strong>policy iteration algorithm</strong> is another approach for solving optimal control problems. It goes as follows.  Say that one uses some policy <span class="math notranslate nohighlight">\(\gamma\)</span> at each step. Assume also that at step <span class="math notranslate nohighlight">\(0\)</span>, the request if for item <span class="math notranslate nohighlight">\(x\)</span> and that one keeps item <span class="math notranslate nohighlight">\(y\)</span> in the buffer.  The expected total discounting cost <span class="math notranslate nohighlight">\(C(x, y)\)</span> is such that</p>
<div class="math notranslate nohighlight">
\[C(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} P(x, x')\rho C(x', \gamma(x',y)).~~~~ (4)\]</div>
<p>Indeed, the cost has two components: the cost of the first step and the cost starting from step <span class="math notranslate nohighlight">\(1\)</span>. Let us examine the cost starting from step <span class="math notranslate nohighlight">\(1\)</span>. With probability <span class="math notranslate nohighlight">\(P(x, x')\)</span>, one starts from step <span class="math notranslate nohighlight">\(1\)</span> when the last request was <span class="math notranslate nohighlight">\(x'\)</span> and one decides to keep <span class="math notranslate nohighlight">\(\gamma(x', y)\)</span> in the buffer, by definition of the policy <span class="math notranslate nohighlight">\(\gamma\)</span>.  Since every step is discounted by one factor <span class="math notranslate nohighlight">\(\rho\)</span> more than starting from step <span class="math notranslate nohighlight">\(0\)</span>, the expected cost starting from step <span class="math notranslate nohighlight">\(1\)</span> is then <span class="math notranslate nohighlight">\(\rho C(x', \gamma(x', y))\)</span>. This justifies (4).</p>
<p>The equations (4) form a system of <span class="math notranslate nohighlight">\(K^2\)</span> <strong>linear</strong> equations.  One can solve them using algebra.<br />
This is called <strong>policy evaluation</strong>: one computes the expected total discounted cost of the policy <span class="math notranslate nohighlight">\(\gamma\)</span>.</p>
<p>The <strong>policy improvement step</strong> is then as follows.  Assume that one uses the policy <span class="math notranslate nohighlight">\(\gamma\)</span> starting from step <span class="math notranslate nohighlight">\(1\)</span> and that <span class="math notranslate nohighlight">\(C(x, y)\)</span> is the expected total cost of that policy, starting from step <span class="math notranslate nohighlight">\(1\)</span>.  Assume that at step <span class="math notranslate nohighlight">\(0\)</span> the request is for item <span class="math notranslate nohighlight">\(x\)</span> and that <span class="math notranslate nohighlight">\(y\)</span> is in the buffer just before step <span class="math notranslate nohighlight">\(0\)</span>.
If we decide to keep item <span class="math notranslate nohighlight">\(y\)</span> in the buffer, we face the expected cost</p>
<div class="math notranslate nohighlight">
\[\sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} \rho C(x', \gamma(x', y)).\]</div>
<p>However, if we replace <span class="math notranslate nohighlight">\(y\)</span> by <span class="math notranslate nohighlight">\(x\)</span>, we face the expected cost</p>
<div class="math notranslate nohighlight">
\[\sum_{x'} P(x, x') 1\{x' \neq x\} + \sum_{x'} \rho C(x', \gamma(x', x)).\]</div>
<p>One then defines the new policy <span class="math notranslate nohighlight">\(\gamma'\)</span> that choose the action that achieves the smaller of these two costs.</p>
<p>The <strong>policy iteration algorithm</strong> repeats the steps of policy evaluation and policy improvement.  We start with an arbitrary policy <span class="math notranslate nohighlight">\(\gamma_0\)</span>, say <span class="math notranslate nohighlight">\(\gamma_0(x, y) = x\)</span> for all <span class="math notranslate nohighlight">\((x, y)\)</span>.  Then, for <span class="math notranslate nohighlight">\(n \geq 0\)</span>, we
evaluate the policy <span class="math notranslate nohighlight">\(\gamma_n\)</span> by solving algebraically the following linear system of equations:</p>
<div class="math notranslate nohighlight">
\[C_n(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} P(x, x')\rho C_n(x', \gamma_n(x',y)).\]</div>
<p>One then defines the policy <span class="math notranslate nohighlight">\(\gamma_{n+1}\)</span> as follows: <span class="math notranslate nohighlight">\(\gamma_{n+1}(x, y) = x\)</span> if</p>
<div class="math notranslate nohighlight">
\[\sum_{x'} P(x, x') 1\{x' \neq x\} + \sum_{x'} \rho C(x', \gamma(x', x)) &lt; \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} \rho C(x', \gamma(x', y))\]</div>
<p>and <span class="math notranslate nohighlight">\(\gamma_{n+1}(x, y) = y\)</span> otherwise. One repeats these steps until the policies stop changing. The cell below implements that algorithm and plots the successive costs <span class="math notranslate nohighlight">\(C_n\)</span> and policies <span class="math notranslate nohighlight">\(\gamma_n\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">policyEvaluation</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">P</span><span class="p">):</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">dim</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># Ax = b</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="n">b</span><span class="p">[</span><span class="n">dim</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="n">dim</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">dim</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">gamma</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">A</span><span class="p">[</span><span class="n">dim</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">dim</span><span class="o">*</span><span class="n">l</span> <span class="o">+</span> <span class="n">c</span><span class="p">]</span> <span class="o">-=</span> <span class="n">rho</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
    <span class="n">Aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Aa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">dim</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>       
<span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">policyEvaluation</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">gamma</span><span class="p">[</span><span class="n">n</span><span class="p">,:,:],</span><span class="n">P</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">gamma</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;C[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Policy Iteration: Cost&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.02</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">j</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;gamma[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Policy Iteration: Policy (values separated for clarity)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_28_0.png" src="_images/control2_28_0.png" />
<img alt="_images/control2_28_1.png" src="_images/control2_28_1.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="reinforcement-learning">
<h1>Reinforcement Learning<a class="headerlink" href="#reinforcement-learning" title="Permalink to this headline">¶</a></h1>
<p>To write down the dynamic programming equations, one needs to know the system model. In our caching example, one needs to know the transition matrix <span class="math notranslate nohighlight">\(P\)</span>. In many situations, one does not know precisely the model. For instance, the statistics of requests in the caching example change over time as new items become more popular.  Reinforcement learning combines the ideas of dynamic programming with learning.</p>
<p>We explain two methods: <strong>Q-Learning</strong> based on value iteration, and <strong>Policy Iteration with Learning</strong>.</p>
<div class="section" id="q-learning">
<h2>Q- Learning<a class="headerlink" href="#q-learning" title="Permalink to this headline">¶</a></h2>
<p>Recall the dynamic programming equations (2):</p>
<div class="math notranslate nohighlight">
\[ \small Q(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\}  + \sum_{x'} P(x, x') \min \{\rho Q(x', x'), \rho Q(x', y)\}.~~~~(2)\]</div>
<p>We can write them as</p>
<div class="math notranslate nohighlight">
\[\small Q(X_n, Y_n) = E \left[ 1\{X_{n+1} \neq Y_n \} + \rho \min\{Q(X_{n+1}, X_{n+1}), Q(X_{n+1}, Y_n)\}\mid X_n, Y_n\right].\]</div>
<p>The key idea of Q-Learning is to replace the expectation by an approximation based on observed transitions.  Before we outline the algorithm, we explain a method for estimating an expected value.</p>
<div class="section" id="estimating-an-expected-value">
<h3>Estimating an expected value<a class="headerlink" href="#estimating-an-expected-value" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(\{X, X_1, X_2, \ldots \}\)</span> be i.i.d.  The strong law of large numbers says that
$<span class="math notranslate nohighlight">\( Z_n := (X_1 + \cdots + X_n)/n \to E[X] \mbox{ as } n \to \infty.\)</span>$
Note that</p>
<div class="math notranslate nohighlight">
\[nZ_n = X_1 + \cdots + X_n = (n-1)Z_{n-1} + X_n.\]</div>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[ Z_n = \frac{n-1}{n} Z_{n-1} + \frac{1}{n} X_n.\]</div>
<p>With <span class="math notranslate nohighlight">\(\delta_n = 1/n\)</span>, this expression can be written as</p>
<div class="math notranslate nohighlight">
\[Z_n = (1 - \delta_n) Z_{n-1} + \delta_n X_n.\]</div>
<p>This suggests that if <span class="math notranslate nohighlight">\(\delta\)</span> is small, then
$<span class="math notranslate nohighlight">\(Z_n = (1 - \delta) Z_{n-1} + \delta X_n \mbox{ approaches } E[X] \mbox{ as } n \to \infty. ~~~ (5)\)</span><span class="math notranslate nohighlight">\(
We test that idea in the cell below where the \)</span>X_n<span class="math notranslate nohighlight">\( are normal with mean \)</span>A<span class="math notranslate nohighlight">\( and variance \)</span>1<span class="math notranslate nohighlight">\(. Both \)</span>A<span class="math notranslate nohighlight">\( and \)</span>\delta$ can be selected with the sliders.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">Ad</span><span class="p">,</span><span class="n">deltad</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">A</span><span class="p">,</span> <span class="n">delta</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ad</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">deltad</span><span class="p">)</span>
    
<span class="n">Ad</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-10&#39;</span><span class="p">,</span> <span class="s1">&#39;-8&#39;</span><span class="p">,</span> <span class="s1">&#39;-6&#39;</span><span class="p">,</span><span class="s1">&#39;-4&#39;</span><span class="p">,</span><span class="s1">&#39;-2&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">,</span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="s1">&#39;10&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">deltad</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0.05&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.15&#39;</span><span class="p">,</span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span><span class="s1">&#39;0.35&#39;</span><span class="p">,</span><span class="s1">&#39;0.4&#39;</span><span class="p">,</span><span class="s1">&#39;0.45&#39;</span><span class="p">,</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span><span class="s1">&#39;0.55&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;0.15&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">Ad</span> <span class="o">=</span> <span class="n">Ad</span><span class="p">,</span> <span class="n">deltad</span> <span class="o">=</span> <span class="n">deltad</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "d7de9469944747e195716584777b0ab7"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">gradAlg1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Z</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;z[n] = (1 - delta)*z[n-1] + delta*X[n]; X[n] = i.i.d. N(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,1)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Observe the impact of delta on the convergence&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The sequence z[n] converges to a neighborhood of A&#39;</span><span class="p">)</span>

<span class="n">gradAlg1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try other parameters, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observe the impact of delta on the convergence
The sequence z[n] converges to a neighborhood of A
</pre></div>
</div>
<img alt="_images/control2_31_1.png" src="_images/control2_31_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try other parameters, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="q-learning-algorithm">
<h3>Q-Learning Algorithm<a class="headerlink" href="#q-learning-algorithm" title="Permalink to this headline">¶</a></h3>
<p>Consider the iteration</p>
<div class="math notranslate nohighlight">
\[W_n(X_n, Y_n) = (1 - \delta ) W_{n-1}(X_{n-1},  Y_n) \]</div>
<div class="math notranslate nohighlight">
\[~~~ + \delta \left[ 1\{X_{n+1} \neq Y_n\} + \rho \min \{W_{n-1}(X_{n+1}, X_{n+1}), W_{n-1}(X_{n+1}, Y_n)\} \right].~~~(6)\]</div>
<p>Assume that <span class="math notranslate nohighlight">\(W_n\)</span> approaches some function <span class="math notranslate nohighlight">\(W\)</span> as <span class="math notranslate nohighlight">\(n \to \infty\)</span> (which can be proved).  Then one has</p>
<div class="math notranslate nohighlight">
\[W_n(X_n, Y_n) \approx (1 - \delta ) W_{n-1}(X_{n-1},  Y_n) \]</div>
<div class="math notranslate nohighlight">
\[~~~ + \delta \left[ 1\{X_{n+1} \neq Y_n\} + \rho \min \{W(X_{n+1}, X_{n+1}), W(X_{n+1}, Y_n)\} \right].\]</div>
<p>In view of (5), this implies that</p>
<div class="math notranslate nohighlight">
\[W_n(X_n, Y_n) \to E\left[ 1\{X_{n+1} \neq Y_n\} + \rho \min \{W(X_{n+1}, X_{n+1}), W(X_{n+1}, Y_n)\} \mid X_n, Y_n \right].\]</div>
<p>But, since <span class="math notranslate nohighlight">\(W_n \to W\)</span>, we conclude that</p>
<div class="math notranslate nohighlight">
\[W(X_n, Y_n) \approx E\left[ 1\{X_{n+1} \neq Y_n\} + \rho \min \{W(X_{n+1}, X_{n+1}), W(X_{n+1}, Y_n)\} \mid X_n, Y_n \right].\]</div>
<p>These are the dynamic programming equations satisfied by <span class="math notranslate nohighlight">\(Q\)</span>.  Hence, <span class="math notranslate nohighlight">\(W \approx Q\)</span> and <span class="math notranslate nohighlight">\(W_n \to Q\)</span>.  In other words, the iteration (6) approaches <span class="math notranslate nohighlight">\(Q\)</span>.  The iteration (6) is called the <strong>Q-Learning Algorithm</strong>.</p>
<p>The next cell implements that algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Q-Learning Algorithm</span>


<span class="k">def</span> <span class="nf">discreteRV</span><span class="p">(</span><span class="n">L</span><span class="p">):</span> <span class="c1"># L is a list of nonnegative numbers</span>
    <span class="c1"># the function returns a RV in range(len(L)) with probabilities</span>
    <span class="c1"># proportional to the corresponding elements of L</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="c1"># we first normalize</span>
    <span class="n">S</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
        <span class="n">S</span> <span class="o">+=</span> <span class="n">L</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">U</span> <span class="o">&lt;</span> <span class="n">S</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">n</span>
            

<span class="n">NP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>


<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.02</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># first item</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># item in buffer</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">Xp</span> <span class="o">=</span> <span class="n">discreteRV</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">X</span><span class="p">,:])</span>
    <span class="n">W</span><span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">Xp</span> <span class="o">!=</span> <span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Xp</span><span class="p">],</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">X</span><span class="p">])</span>
    <span class="n">W</span><span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">Xp</span> <span class="o">!=</span> <span class="n">Y</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Xp</span><span class="p">],</span><span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Y</span><span class="p">])</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">W</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># forced learning</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Xp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Xp</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Q</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Y</span><span class="p">]:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Xp</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Xp</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Q</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Q[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Learning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_33_0.png" src="_images/control2_33_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="policy-iteration-with-learning">
<h2>Policy Iteration with Learning<a class="headerlink" href="#policy-iteration-with-learning" title="Permalink to this headline">¶</a></h2>
<p>Recall the policy iteration algorithm:</p>
<div class="math notranslate nohighlight">
\[C_n(x, y) = \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} P(x, x')\rho C_n(x', \gamma_n(x',y)).~~~(7)\]</div>
<p>The policy <span class="math notranslate nohighlight">\(\gamma_{n+1}\)</span> is defined as follows:</p>
<div class="math notranslate nohighlight">
\[\gamma_{n+1}(x, y) = x \]</div>
<p>if</p>
<div class="math notranslate nohighlight">
\[\sum_{x'} P(x, x') 1\{x' \neq x\} + \sum_{x'} \rho C(x', \gamma(x', x)) &lt; \sum_{x'} P(x, x') 1\{x' \neq y\} + \sum_{x'} \rho C(x', \gamma(x', y))\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\gamma_{n+1}(x, y) = y \mbox{ otherwise.}\]</div>
<p>We note that (7) can be written as</p>
<div class="math notranslate nohighlight">
\[C_n(X_n,Y_n) = E\left[ 1\{X_{n+1} \neq Y_n \} + \rho C_n(X_{n+1}, \gamma_n(X_{n+1}, Y_n)) \mid X_n, Y_n\right].\]</div>
<p>Consider the iteration</p>
<div class="math notranslate nohighlight">
\[ U_n (X_n, Y_n) = (1 - \delta) U_{n-1} (X_n, Y_n)  + \delta  \left[ 1\{X_{n+1} \neq Y_n\} + \rho U_{n-1}(X_{n+1}, \gamma_n(X_{n+1}, Y_n)) \right].\]</div>
<p>Assume that <span class="math notranslate nohighlight">\(U_n\)</span> approaches some function <span class="math notranslate nohighlight">\(U\)</span> as <span class="math notranslate nohighlight">\(n \to \infty\)</span> and that <span class="math notranslate nohighlight">\(\gamma_n\)</span> approaches some <span class="math notranslate nohighlight">\(\gamma\)</span> (which can be shown). Then</p>
<div class="math notranslate nohighlight">
\[U_n (X_n, Y_n) \approx (1 - \delta) U_{n-1} (X_n, Y_n)  + \delta  \left[ 1\{X_{n+1} \neq Y_n\} + \rho U(X_{n+1}, \gamma(X_{n+1}, Y_n)) \right].\]</div>
<p>In view of (5), this implies that</p>
<div class="math notranslate nohighlight">
\[U_n(X_n, Y_n) \approx E\left[ 1\{X_{n+1} \neq Y_n\} + \rho U(X_{n+1}, \gamma(X_{n+1}, Y_n)) \mid X_n, Y_n \right].\]</div>
<p>Since <span class="math notranslate nohighlight">\(U_n \approx U\)</span>, this implies that</p>
<div class="math notranslate nohighlight">
\[U(X_n, Y_n) \approx E\left[ 1\{X_{n+1} \neq Y_n\} + \rho U(X_{n+1}, \gamma(X_{n+1}, Y_n)) \right].\]</div>
<p>These are the dynamic programming equations solved by <span class="math notranslate nohighlight">\(Q\)</span>.  Hence, <span class="math notranslate nohighlight">\(U = Q\)</span> and we conclude that
<span class="math notranslate nohighlight">\(U_n\)</span> approaches <span class="math notranslate nohighlight">\(Q\)</span>, so that <span class="math notranslate nohighlight">\(\gamma_n\)</span> approaches the optimal policy.</p>
<p>The cell below implements that algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Policy Iteration with Learning</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">case</span> <span class="o">=</span> <span class="s1">&#39;PL&#39;</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># first item</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># item in buffer</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">Xp</span> <span class="o">=</span> <span class="n">discreteRV</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">X</span><span class="p">,:])</span>
    <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="p">,:,:]</span>
    <span class="k">if</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Xp</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">X</span><span class="p">]:</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Xp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span>
    <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">Xp</span> <span class="o">!=</span> <span class="n">Y</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span>   
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># forced learning</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Xp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Xp</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Xp</span><span class="p">,</span><span class="n">Y</span><span class="p">]:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Xp</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Xp</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;C[n,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Policy iteration with learning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_35_0.png" src="_images/control2_35_0.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="bandit-problem">
<h1>Bandit Problem<a class="headerlink" href="#bandit-problem" title="Permalink to this headline">¶</a></h1>
<p>We are given two coins <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>.  One has a probability <span class="math notranslate nohighlight">\(0.55\)</span> of tails, the other a probability <span class="math notranslate nohighlight">\(0.45\)</span>, but we don’t know which is which: coin <span class="math notranslate nohighlight">\(A\)</span> has probability of tails equal to <span class="math notranslate nohighlight">\(0.55\)</span> with probability <span class="math notranslate nohighlight">\(0.5\)</span>.  The problem is to choose, at each step, which coin to flip in order to accumulate tails as fast as possible.</p>
<p>If we knew which coin is the best, we would accumulate <span class="math notranslate nohighlight">\(0.55n\)</span> tails in <span class="math notranslate nohighlight">\(n\)</span> steps, on average.  Since we don’t know, we will accumulate some average number <span class="math notranslate nohighlight">\(S(n)\)</span> of tails after <span class="math notranslate nohighlight">\(n\)</span> steps. One defines the <strong>regret</strong> <span class="math notranslate nohighlight">\(R(n) = 0.55n - S(n)\)</span>.  The goal is to desing a strategy that makes <span class="math notranslate nohighlight">\(R(n)\)</span> small, as <span class="math notranslate nohighlight">\(n\)</span> gets large.</p>
<p>For instance, if we eventually settle on one of the two coins and if there is a probability <span class="math notranslate nohighlight">\(p\)</span> that we settle on the wrong coin, then <span class="math notranslate nohighlight">\(R(n)\)</span> grows like <span class="math notranslate nohighlight">\(p \times 0.1n\)</span> for <span class="math notranslate nohighlight">\(n\)</span> large.
One can show that no strategy exists with <span class="math notranslate nohighlight">\(R(n)\)</span> smaller than <span class="math notranslate nohighlight">\(O(\log(n)\)</span>.  Also, a simple stragey achieves that rate of growth of the regret.  That strategy is <strong>Thompson sampling</strong>.  It is defined as follows.  At step <span class="math notranslate nohighlight">\(n\)</span>, the Thompson strategy flips coin <span class="math notranslate nohighlight">\(A\)</span> with the probability that it is the best coin given the past coin flips.  This is a remarkable result because discovering the probability that coin <span class="math notranslate nohighlight">\(A\)</span> is the best depends on the fraction of time that we flip it.  The cell below simulates the Thompson sampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dummy</span><span class="p">(</span><span class="n">Nd</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">N</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nd</span><span class="p">)</span>
    
<span class="n">Nd</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">,</span><span class="s1">&#39;1000&#39;</span><span class="p">,</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span><span class="s1">&#39;3000&#39;</span><span class="p">,</span><span class="s1">&#39;4000&#39;</span><span class="p">,</span><span class="s1">&#39;5000&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;1000&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="n">Nd</span><span class="o">=</span><span class="n">Nd</span><span class="p">)</span> 
<span class="n">display</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "55e098d39bc0457a87d4e19a6c4115aa"}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># Thompson Sampling</span>
<span class="c1"># p(m,n,M,N) = P(coin 0 is best given</span>
<span class="c1"># m &#39;0s&#39; out on M with a=0 and n &#39;0s&#39; out of N with a=1</span>
<span class="c1"># Bayes&#39; Rule gives p(m,n,M,N)) = 1/(1 + Q(m,n,M,N))</span>
<span class="c1"># where Q(m,n,M,N) = (0.55/0.45)**(2(m-n)+ N - M)</span>
<span class="c1"># Thus, Q is multiplied by 0.55/0.45 </span>
<span class="c1">#     when M += 1 and m += 1 and N += 1 and n += 0</span>
<span class="c1"># and Q is divided by 0.55/0.45 </span>
<span class="c1">#.  when M += 1 and m += 0 and N += 1 and n += 1</span>
<span class="c1"># Let U be the next action and Y the next outcome:</span>
<span class="c1">#    if U == Y: Q = Q*0.55/0.45, else, Q = Q*0.45/0.55</span>
         
<span class="k">def</span> <span class="nf">TS</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># accumulated rewards</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># best rewards</span>
    <span class="n">LOG</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">]</span> <span class="c1"># coin 1 is best</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">]</span> <span class="c1"># coin 0 is best</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="c1"># choose coin</span>
        <span class="c1"># if P[n] &lt;&lt; 1, U[n] is likely to be 1 because coin 0</span>
        <span class="c1"># is unlikely to be best</span>
        <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">coin</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coin</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">coin</span><span class="p">)</span>
        <span class="n">R</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coin</span> <span class="o">==</span> <span class="mf">0.55</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.55</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span><span class="o">*</span><span class="mf">0.55</span><span class="o">/</span><span class="mf">0.45</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span><span class="o">*</span><span class="mf">0.45</span><span class="o">/</span><span class="mf">0.55</span>    
        <span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Q</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.55</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="s1">&#39;; coin 0 is best&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="s1">&#39;; coin 1 is best&#39;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rewards with TS&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best rewards&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">R</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Difference&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">P</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; times Prob. that 0 is best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Thompson Sampling with Coins&#39;</span> <span class="o">+</span> <span class="n">W</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   
<span class="n">TS</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If you want to try another value of N, </span><span class="se">\n</span><span class="s1"> go back to widgets above, select, and rerun this cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/control2_38_0.png" src="_images/control2_38_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If you want to try another value of N, 
 go back to widgets above, select, and rerun this cell
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="exercise-on-control">
<h1>Exercise on Control<a class="headerlink" href="#exercise-on-control" title="Permalink to this headline">¶</a></h1>
<p>Consider the caching problem</p>
<ul class="simple">
<li><p>Assume the buffer can store two items</p></li>
<li><p>There are 5 types of items with the following transition matrix:</p></li>
</ul>
<p><img alt="title" src="_images/requests.pdf" /></p>
<ul class="simple">
<li><p>What is the state?</p></li>
<li><p>How many states are there?</p></li>
<li><p>What are the possible actions?</p></li>
<li><p>How many actions are possible in each state?</p></li>
<li><p>How many possible strategies are there?</p></li>
<li><p>Write the dynamic programming equations</p></li>
<li><p>Solve them by using value iteration</p></li>
<li><p>Plot the minimum expected cost to go from a state that you choose as a function of the iteration step in the value iteration algorithm.</p></li>
</ul>
</div>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"00f0424765cb40f28a8a4f17b6aca26d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ead47732f0354176ad418402131d2e1b": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "376224f245f14b7fa87bc99658df7ecd": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["0", "0.05", "0.1", "0.15", "0.2", "0.25", "0.3", "0.35", "0.4"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "a", "description_tooltip": null, "disabled": false, "index": 4, "layout": "IPY_MODEL_00f0424765cb40f28a8a4f17b6aca26d", "style": "IPY_MODEL_ead47732f0354176ad418402131d2e1b"}}, "df8030d5119a48f985cc8ce16255d418": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5f12f605b43140bb9b0ff92642804fdd": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "d2352ec085714fdf91aa70fb38737b1b": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["0", "0.05", "0.1", "0.15", "0.2", "0.25", "0.3", "0.35", "0.4"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "b", "description_tooltip": null, "disabled": false, "index": 2, "layout": "IPY_MODEL_df8030d5119a48f985cc8ce16255d418", "style": "IPY_MODEL_5f12f605b43140bb9b0ff92642804fdd"}}, "3ee6591274074ea893a66c2b1e0f03d1": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "24e0bd4927134f78841104861b193157": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "193bf3962e494a5787ee1ffdcb628f5e": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "x", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_3ee6591274074ea893a66c2b1e0f03d1", "style": "IPY_MODEL_24e0bd4927134f78841104861b193157"}}, "b0b11d267be040f78e9c913ac8f8de11": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "09ab14fff40847c694b84eb537a81090": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "4f9c57c896c0402fb853f0fa0664c294": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_b0b11d267be040f78e9c913ac8f8de11", "style": "IPY_MODEL_09ab14fff40847c694b84eb537a81090"}}, "ca26d66e2e8544e1817eb8a71f59f5df": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4e612b4a9e1c439ebcc47f6e1883467b": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "9807c291dedf4fef840176c36b6fb53a": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["5", "10", "20", "30", "50", "100", "150", "200", "300", "400", "500"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 5, "layout": "IPY_MODEL_ca26d66e2e8544e1817eb8a71f59f5df", "style": "IPY_MODEL_4e612b4a9e1c439ebcc47f6e1883467b"}}, "618e77960c7048f89f3a025cf5d24cc6": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5ac7bcff09d74381846949e24ec8d565": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_376224f245f14b7fa87bc99658df7ecd", "IPY_MODEL_d2352ec085714fdf91aa70fb38737b1b", "IPY_MODEL_193bf3962e494a5787ee1ffdcb628f5e", "IPY_MODEL_4f9c57c896c0402fb853f0fa0664c294", "IPY_MODEL_9807c291dedf4fef840176c36b6fb53a", "IPY_MODEL_23eaf3421bf3440591be0d44dcfd4d3b"], "layout": "IPY_MODEL_618e77960c7048f89f3a025cf5d24cc6"}}, "d2b2c53edfcf4f0f832bdd1a7999e1bd": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "23eaf3421bf3440591be0d44dcfd4d3b": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_d2b2c53edfcf4f0f832bdd1a7999e1bd", "msg_id": "", "outputs": []}}, "773b71315bd34ffab917e37a4b6d7d56": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "2cba6558daa742518c3fc748e01092e3": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "8fc02cebe03345c38e9192437e0a9bc0": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "x", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_773b71315bd34ffab917e37a4b6d7d56", "style": "IPY_MODEL_2cba6558daa742518c3fc748e01092e3"}}, "4c3c16a0a5304d8c93acca03b5c33829": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "6f8c8d075eb140538dad8e15d70dcd48": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "c6d58d2c7d9a489d91b3773e45284512": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_4c3c16a0a5304d8c93acca03b5c33829", "style": "IPY_MODEL_6f8c8d075eb140538dad8e15d70dcd48"}}, "d1e1cb8c2462417b84050e9c609db7d3": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4d6ee48208524eaaab80c8ba51cc516d": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "bb970da6cf814b2397fa458c12e35e01": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["5", "10", "20", "30", "50", "100", "150", "200", "300", "400", "500"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 5, "layout": "IPY_MODEL_d1e1cb8c2462417b84050e9c609db7d3", "style": "IPY_MODEL_4d6ee48208524eaaab80c8ba51cc516d"}}, "c94d1e4533254d93be6a60e750fd4f1f": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "1ebfb1160ef843b285b245672dadd6b8": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_8fc02cebe03345c38e9192437e0a9bc0", "IPY_MODEL_c6d58d2c7d9a489d91b3773e45284512", "IPY_MODEL_bb970da6cf814b2397fa458c12e35e01", "IPY_MODEL_be30fa374bd546348027cedd5ef69cf4"], "layout": "IPY_MODEL_c94d1e4533254d93be6a60e750fd4f1f"}}, "776c2d02bcbe46dab6d7df0b196bcfb4": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "be30fa374bd546348027cedd5ef69cf4": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_776c2d02bcbe46dab6d7df0b196bcfb4", "msg_id": "", "outputs": []}}, "c8ad6d1880d84837b0fbd55991f54d70": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7ce364f348d049fea9fe0f420451f44e": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "123137e741484a1685006a2a1c0c3f00": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "x", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_c8ad6d1880d84837b0fbd55991f54d70", "style": "IPY_MODEL_7ce364f348d049fea9fe0f420451f44e"}}, "0d4aa10a4afa4d04b99a0701cbe7df6d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0204475d47a34163bc213bb86c9f6182": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "c9ec72b75c9b4b5cb48ee60d49ee52a0": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_0d4aa10a4afa4d04b99a0701cbe7df6d", "style": "IPY_MODEL_0204475d47a34163bc213bb86c9f6182"}}, "004a2200f07c48b18dd8eb4c10b0c0c5": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "f2205c8acc3045a792f57abc611e2dfc": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "1d1fbb000c264e18af03e1281c63235e": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["0", "0.05", "0.1", "0.15", "0.2", "0.25", "0.3"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "s", "description_tooltip": null, "disabled": false, "index": 2, "layout": "IPY_MODEL_004a2200f07c48b18dd8eb4c10b0c0c5", "style": "IPY_MODEL_f2205c8acc3045a792f57abc611e2dfc"}}, "9ee3178bb4f441d0ac9062579b103b32": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3ba1eadc35414933be22ea57fc9eca5d": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "8821ded0c02348178124857af7aba0d6": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["5", "10", "20", "30", "50", "100", "150", "200", "300", "400", "500"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 5, "layout": "IPY_MODEL_9ee3178bb4f441d0ac9062579b103b32", "style": "IPY_MODEL_3ba1eadc35414933be22ea57fc9eca5d"}}, "34a931f8be3042a697a2f67f07d23be0": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "9e95f9aca52a42fe9f34c1200c5c9324": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_123137e741484a1685006a2a1c0c3f00", "IPY_MODEL_c9ec72b75c9b4b5cb48ee60d49ee52a0", "IPY_MODEL_1d1fbb000c264e18af03e1281c63235e", "IPY_MODEL_8821ded0c02348178124857af7aba0d6", "IPY_MODEL_d74570ed5dde411099610aa29fa94607"], "layout": "IPY_MODEL_34a931f8be3042a697a2f67f07d23be0"}}, "da980fd0c7e441b8813e6dba83e188c8": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d74570ed5dde411099610aa29fa94607": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_da980fd0c7e441b8813e6dba83e188c8", "msg_id": "", "outputs": []}}, "1d947a7e73ba44acb7f442cc25ecca82": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "b729dc9b204445d2b2d4b45f304d1ce5": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "25ffa3656c04439baa3318a2614137e3": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "x0", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_1d947a7e73ba44acb7f442cc25ecca82", "style": "IPY_MODEL_b729dc9b204445d2b2d4b45f304d1ce5"}}, "17089be97a5b4ed19a561ff563f7f6d8": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "6c172e2f8fc743f5a08468472e855283": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "52348d253ec44ea69b138a8a0ae1f786": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v0", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_17089be97a5b4ed19a561ff563f7f6d8", "style": "IPY_MODEL_6c172e2f8fc743f5a08468472e855283"}}, "06c1e1f4667c4278a61c4ba10e39bdbe": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0f145b1105ea47b48368674244362f3d": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "a2595907eba44d1da263d7aba3f85e66": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "x1", "description_tooltip": null, "disabled": false, "index": 4, "layout": "IPY_MODEL_06c1e1f4667c4278a61c4ba10e39bdbe", "style": "IPY_MODEL_0f145b1105ea47b48368674244362f3d"}}, "c8c1aabfa8454ce3b6504dd4c85b182a": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "074ca5f6695944818959ff945160c96f": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "24a48d79adcb44859d77b19a078f18fa": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-5", "-4", "-3", "-2", "-1", "0", "1", "2", "3", "4", "5"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v1", "description_tooltip": null, "disabled": false, "index": 3, "layout": "IPY_MODEL_c8c1aabfa8454ce3b6504dd4c85b182a", "style": "IPY_MODEL_074ca5f6695944818959ff945160c96f"}}, "27695924f57940c98bb0a829a3453e57": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "210689c355f245689313b818c6aa5341": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "5d94c62676f1474289bbced8ef434a86": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["5", "10", "20", "30", "50", "100", "150", "200", "300", "400", "500"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "v", "description_tooltip": null, "disabled": false, "index": 5, "layout": "IPY_MODEL_27695924f57940c98bb0a829a3453e57", "style": "IPY_MODEL_210689c355f245689313b818c6aa5341"}}, "4ff9d40c18b744e2be006756ac38bdd7": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ccb0b338d0e644e3ad4c60f478f4223a": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_25ffa3656c04439baa3318a2614137e3", "IPY_MODEL_52348d253ec44ea69b138a8a0ae1f786", "IPY_MODEL_a2595907eba44d1da263d7aba3f85e66", "IPY_MODEL_24a48d79adcb44859d77b19a078f18fa", "IPY_MODEL_5d94c62676f1474289bbced8ef434a86", "IPY_MODEL_a87fd6872f6f4a10a6788507edd52b49"], "layout": "IPY_MODEL_4ff9d40c18b744e2be006756ac38bdd7"}}, "160f93a9220e402380a713e6eab47ee7": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a87fd6872f6f4a10a6788507edd52b49": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_160f93a9220e402380a713e6eab47ee7", "msg_id": "", "outputs": []}}, "fee3058d16c443829be7dd0f60d90eb3": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "f0c528dd03ad4c35922ae7ac23d58b0b": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "334496be8dd247e795c6a795b1960a8c": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["-10", "-8", "-6", "-4", "-2", "0", "2", "4", "6", "8", "10"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "A", "description_tooltip": null, "disabled": false, "index": 7, "layout": "IPY_MODEL_fee3058d16c443829be7dd0f60d90eb3", "style": "IPY_MODEL_f0c528dd03ad4c35922ae7ac23d58b0b"}}, "ca8223fa868e4c75926254eeae91d0dd": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "436f2932a78a4e64930538141e43bdc0": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "980eb01204854522837a9cedf15c0b57": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["0.05", "0.1", "0.15", "0.2", "0.25", "0.3", "0.35", "0.4", "0.45", "0.5", "0.55"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "delta", "description_tooltip": null, "disabled": false, "index": 2, "layout": "IPY_MODEL_ca8223fa868e4c75926254eeae91d0dd", "style": "IPY_MODEL_436f2932a78a4e64930538141e43bdc0"}}, "a762cafcc39341de93adec08d76e470b": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d7de9469944747e195716584777b0ab7": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_334496be8dd247e795c6a795b1960a8c", "IPY_MODEL_980eb01204854522837a9cedf15c0b57", "IPY_MODEL_7d9b08ba285049d2962240521e054ba4"], "layout": "IPY_MODEL_a762cafcc39341de93adec08d76e470b"}}, "afdc78cbb12e46869c27a94d8d855f30": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7d9b08ba285049d2962240521e054ba4": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_afdc78cbb12e46869c27a94d8d855f30", "msg_id": "", "outputs": []}}, "fd9b5a34f331400fa99d865ef1913772": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "baeae8c63e9f48e8908bcccf2ed06b67": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "4eafc3bf1d2045e6b7ef92254f4bd8bd": {"model_name": "DropdownModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DropdownModel", "_options_labels": ["100", "200", "500", "1000", "2000", "3000", "4000", "5000"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "DropdownView", "description": "N", "description_tooltip": null, "disabled": false, "index": 3, "layout": "IPY_MODEL_fd9b5a34f331400fa99d865ef1913772", "style": "IPY_MODEL_baeae8c63e9f48e8908bcccf2ed06b67"}}, "fc893c6e0d0f49bab8a97020c78ff691": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "55e098d39bc0457a87d4e19a6c4115aa": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_4eafc3bf1d2045e6b7ef92254f4bd8bd", "IPY_MODEL_5969d2358cd84efc8f32a4599ba679c6"], "layout": "IPY_MODEL_fc893c6e0d0f49bab8a97020c78ff691"}}, "667aa574d4bd461ebb0dbc8871b83f98": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5969d2358cd84efc8f32a4599ba679c6": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_667aa574d4bd461ebb0dbc8871b83f98", "msg_id": "", "outputs": []}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jeanwalrand/Notes_on_AI.git",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Jean Walrand<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>